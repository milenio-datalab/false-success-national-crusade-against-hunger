var Vis=(function(){var g;var x;var v;var a;var l;var d;var M;var f;var p;var u=d3.format(".2f");var b;var z;var q;var I;var R;var n;var D;var N;var r;var H;var s;var t;function C(T){g=T;x=d3.select("#"+g);v=document.getElementById(g).getBoundingClientRect();a=v.width;l=a;b=a;z=b;f=478;p=10;this.render()}var c=function(){x.html("")};var J=function(){d=x.append("svg").attr("width",a).attr("height",l);M=d.append("g")};var K=function(){d.attr("height",M.node().getBBox().height+p*1)};var O=function(){J();Q();m();i();A();K()};var j=function(T){queue().defer(d3.json,"data/m.json").defer(d3.csv,"data/cobertura_cnch.csv").defer(d3.json,"data/e.json").await(function(V,W,U,X){W.objects.m.geometries.forEach(function(Y){U.forEach(function(Z){if(parseInt(Y.properties.CVEGEO)==parseInt(Z.id_mun)){Y.properties.dif=Z.cobertura_programas*100}})});s=W;t=X;T()})};var Q=function(){q=d3.geo.mercator().scale(821.329355695949).center([-102.5686847699085,17.7]).translate([b/2,z/2]);N=d3.behavior.zoom().scaleExtent([1,Infinity]).on("zoom",P);R=M.append("g").attr("id","map-g");d.call(N)};var P=function(){n.attr("transform","translate("+N.translate()+")scale("+N.scale()+")").selectAll("path").style("stroke-width",0.1/N.scale()+"px");D.attr("transform","translate("+N.translate()+")scale("+N.scale()+")").selectAll("path").style("stroke-width",0.75/N.scale()+"px")};var e=function(T){if(T>=0&&T<=20){return"0-20"}else{if(T>20&&T<=40){return"20-40"}else{if(T>40&&T<=60){return"40-60"}else{if(T>60&&T<=80){return"60-80"}else{if(T>80&&T<=100){return"80-100"}else{return"mas-100"}}}}}};var m=function(){r=d3.scale.linear().domain([0,25,50,75,100,101,1000]).range(["#d7191c","#fdae61","#ffffbf","#a6d96a","#1a9641","#1998CD","#8B2F82"]);I=d3.geo.path().projection(q);n=R.append("g").attr("id","g-map-municipios");n.selectAll("path").data(topojson.feature(s,s.objects.m).features).enter().append("path").attr("class",function(T){return"municipio cobertura-"+e(T.properties.dif)}).attr("d",I).style("fill",function(T){return(typeof r(T.properties.dif)=="string"?r(T.properties.dif):"")}).on("click",y).on("mouseover",S).on("mousemove",w).on("mouseout",o)};var y=function(T){console.log(T.properties);d3.select("div#viz-info span.info-entidad").html(T.properties.NOM_ENT);d3.select("div#viz-info span.info-municipio").html(T.properties.NOM_MUN);d3.select("div#viz-info span.info-cobertura").html(u(T.properties.dif)+"%");d3.select("div#viz-info td.cobertura").style("background-color",(typeof r(T.properties.dif)=="string"?r(T.properties.dif):""))};var h={x:5,y:-25};var F=d3.select("body").append("div").attr("class","tooltip");var S=function(U){w();var T=parseInt(U.properties.CVEGEO.substring(0,2));F.style("display","block").text(U.properties.NOM_MUN+" ("+B(T)+")")};var w=function(){F.style("top",(d3.event.pageY+h.y)+"px").style("left",(d3.event.pageX+h.x)+"px")};var o=function(){F.style("display","none")};var i=function(){D=R.append("g").attr("id","g-map-estados");D.selectAll("path").data(topojson.feature(t,t.objects.e).features).enter().append("path").attr("class","estado").attr("d",I)};var A=function(){var U=R.node().getBBox().height+p*2;H=M.append("g").attr("id","g-ui").attr("transform","translate(0, "+U+")");var T=(a-p*7)/6;var V=30;G(p,0,T,V,"0 to 20%","0-20");G(T+p*2,0,T,V,"20 to 40%","20-40");G(T*2+p*3,0,T,V,"40 to 60%","40-60");G(T*3+p*4,0,T,V,"60 to 80%","60-80");G(T*4+p*5,0,T,V,"80 to 100%","80-100");G(T*5+p*6,0,T,V,"+ 100%","mas-100");G(T*4+p*5,V+p/2,T*2+p,V,"Center map",null);L()};var G=function(V,Z,Y,X,U,T){var W=H.append("rect").attr("class","button cobertura-"+T).attr("x",V).attr("y",Z).attr("width",Y).attr("height",X).on("click",function(){if(T!=null){E(T)}else{k()}});if(T==null){W.style("fill","#333")}H.append("text").attr("class","ui-button-text cobertura-"+T).attr("x",V+Y/2).attr("y",Z+X/2).style("dominant-baseline","central").text(U)};var L=function(){var T=(a-p*7)/6;var U=30;var V=["0-20","20-40","40-60","60-80","80-100","mas-100"];H.append("rect").attr("x",p).attr("y",U+p/2).attr("width",T*2+p).attr("height",U).style("fill","#333").on("click",function(){V.forEach(function(X){var W=d3.select("rect.button.cobertura-"+X);if(W.classed("off")){E(X)}})});H.append("text").attr("class","ui-button-text").attr("x",p/2+T).attr("y",U+p/2+U/2).style("dominant-baseline","central").text("All");H.append("rect").attr("x",p*3+T*2).attr("y",U+p/2).attr("width",T*2+p).attr("height",U).style("fill","#333").on("click",function(){V.forEach(function(X){var W=d3.select("rect.button.cobertura-"+X);if(!W.classed("off")){E(X)}})});H.append("text").attr("class","ui-button-text").attr("x",p*3+p/2+T*3).attr("y",U+p/2+U/2).style("dominant-baseline","central").text("None")};var k=function(){N.scale(1).translate([0,0]);P()};var E=function(T){var U=d3.select("rect.button.cobertura-"+T);var V=d3.select("text.ui-button-text.cobertura-"+T);if(U.classed("off")){U.classed("off",false);V.classed("off",false);d3.selectAll("path.cobertura-"+T).style("fill",function(W){return(typeof r(W.properties.dif)=="string"?r(W.properties.dif):"")}).style("pointer-events","all")}else{U.classed("off",true);V.classed("off",true);d3.selectAll("path.cobertura-"+T).style("fill","#E2E3E4").style("pointer-events","none")}};var B=function(T){var U=["AGS","BC","BCS","CAMP","COAH","COL","CHIS","CHIH","CDMX","DGO","GTO","GRO","HGO","JAL","MEX","MICH","MOR","NAY","NL","OAX","PUE","QRO","QROO","SLP","SIN","SON","TAB","TAMPS","TLAX","VER","YUC","ZAC"];return U[parseInt(T-1)]};C.prototype={render:function(){c();j(O)}};return C})();new Vis("vis");