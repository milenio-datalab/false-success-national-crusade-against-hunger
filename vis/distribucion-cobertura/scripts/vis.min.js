var Vis=(function(){var e;var w;var u;var a;var l;var c;var S;var o;var s=d3.format(".0f");var f=d3.format("05d");var d;var L;var j=6;var k=j+1;var g;var K;var E;var A={cobertura_programas:63.65/100,cobertura_prog_hambre:51.37/100,cve_ent:33,mun:"--"};var p;var Y;var B;var W;function F(Z){e=Z;w=d3.select("#"+e);u=document.getElementById(e).getBoundingClientRect();a=u.width;l=a;o=10;this.render()}var b=function(){w.html("")};var Q=function(){c=w.append("svg").attr("width",a).attr("height",l);S=c.append("g")};var R=function(){c.attr("height",S.node().getBBox().height)};var T=function(){Q();C();r();O();R();z(A)};var i=function(Z){queue().defer(d3.csv,"data/cobertura_cnch.csv").defer(d3.csv,"data/estados_municipios.csv").await(function(ad,ab,ac){B=ab;W=ac;var aa=d3.max(B,function(ae){return +ae.cobertura_programas});d=d3.scale.linear().domain([0,25,50,75,100,101,aa*100]).range(["#d7191c","#fdae61","#ffffbf","#a6d96a","#1a9641","#1998CD","#8B2F82"]);B.forEach(function(af,ae){af.cve_mun=f(af.id_mun);af.cve_ent=af.cve_mun.substring(0,2)});B.sort(function(af,ae){return ae.cobertura_programas-af.cobertura_programas});B.forEach(function(af,ae){af.orden_tp=ae});B.sort(function(af,ae){return ae.cobertura_prog_hambre-af.cobertura_prog_hambre});B.forEach(function(af,ae){af.orden_ph=ae});Z()})};var O=function(){L=S.append("g").attr("class","g-municipios").attr("transform","translate(0, "+(40+Y.node().getBBox().height+40)+")");L.selectAll("rect").data(B).enter().append("rect").attr("class",function(aa,Z){return"municipio cve-ent-"+aa.cve_ent+" cve-mun-"+aa.cve_mun}).attr("x",function(aa,Z){return m(aa.orden_tp,aa.cobertura_programas)[0]}).attr("y",function(aa,Z){return m(aa.orden_tp,aa.cobertura_programas)[1]}).attr("width",6).attr("height",6).style("fill",function(Z){return(typeof d(Math.floor(+Z.cobertura_programas*100))=="string"?d(Math.floor(+Z.cobertura_programas*100)):"")}).on("click",z).on("mouseover",X).on("mousemove",v).on("mouseout",n);P("tp")};var U=d3.scale.threshold().domain([0,21,41,61,81,101]).range([6,5,4,3,2,1,0]);var m=function(af,ag){var aj=15;var aa=6;var ac=aa+1;var ae=+ag*100;var Z=U(ae)*ac*2;var ad=af%64;var ai=aj+(ac*ad);var ab=Math.floor(af/64);var ah=(ac*ab)+Z;return[ai,ah]};var H;var M=function(Z){if(H!=Z){L.selectAll("rect").transition().duration(500).delay(function(ab,aa){return aa/5}).attr("x",function(aa){if(Z=="tp"){return m(aa.orden_tp,aa.cobertura_programas)[0]}return m(aa.orden_ph,aa.cobertura_prog_hambre)[0]}).attr("y",function(aa){if(Z=="tp"){return m(aa.orden_tp,aa.cobertura_programas)[1]}return m(aa.orden_ph,aa.cobertura_prog_hambre)[1]}).attr("width",6).attr("height",6);H=Z;t(Z)}};var V=[-1*k,6*k,10*k,17*k,28*k,42*k,50*k];var q=[-1*k,4*k,8*k,13*k,22*k,37*k,50*k];var N=["1,516%","100%","80%","60%","40%","20%","0%"];var G=["1,325%","100%","80%","60%","40%","20%","0%"];var P=function(Z){d3.select("g.g-legends").remove();d3.select("g.g-levels").remove();g=S.append("g").attr("class","g-levels").attr("transform","translate(0, "+(40+Y.node().getBBox().height+40)+")");var ab=(Z=="tp")?V:q;var aa=(Z=="tp")?N:G;ab.forEach(function(ad,ac){g.append("line").attr("class","level-line").attr("x1",15).attr("y1",ab[ac]).attr("x2",35).attr("y2",ab[ac]).style("stroke-width",1).style("stroke","#333").style("opacity",0).transition().duration(1500).style("opacity",1);g.append("text").attr("class","level-text").attr("x",40).attr("y",ab[ac]).style("dominant-baseline","central").text(aa[ac]).style("opacity",0).transition().duration(1500).style("opacity",1)})};var t=function(Z){var ab=(Z=="tp")?V:q;var aa=(Z=="tp")?N:G;d3.selectAll("line.level-line").each(function(ad,ac){d3.select(this).transition().duration(1000).attr("y1",ab[ac]).attr("y2",ab[ac])});d3.selectAll("text.level-text").each(function(ad,ac){d3.select(this).transition().duration(1000).text(aa[ac]).attr("y",ab[ac])})};var z=function(Z){var ab=Math.floor(Z.cobertura_programas*100);var aa=Math.floor(Z.cobertura_prog_hambre*100);d3.select("div#viz-info span.info-entidad").html(y(parseInt(Z.cve_ent)));d3.select("div#viz-info span.info-municipio").html(Z.mun);d3.select("div#viz-info span.info-cobertura-tp").html(s(ab)+"%");d3.select("div#viz-info span.info-cobertura-ph").html(s(aa)+"%");d3.select("div#viz-info td.porcentaje.tp").style("background-color",(typeof d(ab)=="string"?d(ab):""));d3.select("div#viz-info td.porcentaje.ph").style("background-color",(typeof d(aa)=="string"?d(aa):""));J(Z)};var x=true;var J=function(Z){if(Z.id_mun=="12035"&&x){console.log("Nos faltan 43. Vivos se los llevaron, vivos los queremos.");x=false}if(Z.cve_ent<=32){if(K==Z.cve_ent){d3.selectAll(".municipio").classed("disabled",false).classed("selected",false).classed("selected-extra",false);K=undefined;z(A)}else{K=Z.cve_ent;d3.selectAll(".municipio").classed("disabled",true).classed("selected",false).classed("selected-extra",false);d3.selectAll(".municipio.cve-ent-"+Z.cve_ent).classed("disabled",false).classed("selected",true);d3.selectAll(".municipio.cve-mun-"+Z.cve_mun).classed("selected-extra",true)}}};var r=function(){p=S.append("g").attr("class","g-scale").attr("transform","translate(0, "+(Y.node().getBBox().height+20)+")");var ab=[0,10,20,30,40,50,60,70,80,90,100,101,1500];var aa=[0,10,20,30,40,50,60,70,80,90,100,"+100",1500];var Z=(478-15*2)/ab.length;p.append("text").attr("class","scale-legend").attr("x",15).attr("y",8).style("font-size",10).text("Coverage with programs for people who suffer from extreme poverty and malnourisment");ab.forEach(function(ad,ac){p.append("rect").attr("x",15+ac*Z).attr("y",12).attr("width",Z).attr("height",10).attr("stroke","#fff").attr("fill",d(ad));p.append("text").attr("class","scale-legend").attr("x",15+ac*Z).attr("y",32).style("font-size",10).text(aa[ac]+"%")})};var C=function(){Y=S.append("g").attr("id","g-ui").attr("transform","translate(0, "+(0)+")");var Z=(a-15*3)/2;var aa=30;Y.append("rect").attr("class","selected").attr("x",15).attr("y",0).attr("width",Z).attr("height",aa).on("click",function(){d3.selectAll("#g-ui rect").classed("selected",false);d3.select(this).classed("selected",true);M("tp")});Y.append("text").attr("class","button-text").attr("x",15+Z/2).attr("y",aa/2).style("dominant-baseline","central").text("All programs");Y.append("rect").attr("x",15*2+Z).attr("y",0).attr("width",Z).attr("height",aa).on("click",function(){d3.selectAll("#g-ui rect").classed("selected",false);d3.select(this).classed("selected",true);M("ph")});Y.append("text").attr("class","button-text").attr("x",15*2+Z+Z/2).attr("y",aa/2).style("dominant-baseline","central").text("Only programs that combat hunger")};var h={x:5,y:-32};var I=d3.select("body").append("div").attr("class","tooltip");var X=function(Z){v();I.style("display","block").text(Z.mun+" ("+D(Z.cve_ent)+")")};var v=function(){I.style("top",(d3.event.pageY+h.y)+"px").style("left",(d3.event.pageX+h.x)+"px")};var n=function(){I.style("display","none")};var D=function(Z){var aa=["AGS","BC","BCS","CAMP","COAH","COL","CHIS","CHIH","CDMX","DGO","GTO","GRO","HGO","JAL","MEX","MICH","MOR","NAY","NL","OAX","PUE","QRO","QROO","SLP","SIN","SON","TAB","TAMPS","TLAX","VER","YUC","ZAC"];return aa[parseInt(Z-1)]};var y=function(Z){var aa=["Aguascalientes","Baja California","Baja California Sur","Campeche","Coahuila","Colima","Chiapas","Chihuahua","Ciudad de México","Durango","Guanajuato","Guerrero","Hidalgo","Jalisco","Estado de México","Michoacán","Morelos","Nayarit","Nuevo León","Oaxaca","Puebla","Querétaro","Quintana Roo","San Luis Potosí","Sinaloa","Sonora","Tabasco","Tamaulipas","Tlaxcala","Veracruz","Yucatán","Zacatecas","All the country"];return aa[parseInt(Z-1)]};F.prototype={render:function(){b();i(T)}};return F})();new Vis("vis");