var Vis=(function(){var i;var v;var u;var c;var r;var g;var O;var D;var T;var e;var h;var t;var R;var o;var y=500;var d;var J=d3.format(",d");var j;var l=18;var M;var Q=l*1.5;var S=Q;var F;var w;var N;var H;var a;var b;var s;var q;var k;var m;function B(U){i=U;v=d3.select("#"+i);u=document.getElementById(i).getBoundingClientRect();c=u.width;r=c/2;h=1160;t=E(20);if(c<600){M=S/2.5;F=t*0.75;N=130*130}else{if(c<1200){M=S/2.5;F=t/1.5;N=220*220}else{M=S/2;F=t/3;N=220*220}}this.render()}var E=function(U){return U*c/h};var p=function(U){var V=document.createEvent("UIEvents");V.initUIEvent("click",true,true);U.node().dispatchEvent(V)};var f=function(){v.html("")};var L=function(){g=v.append("svg").attr("width",c).attr("height",r);O=g.append("g");m=textures.lines().size(3).strokeWidth(1).stroke("#eee").background("#bbb");g.call(m)};var K=function(){g.attr("height",O.node().getBBox().height)};var z=function(){var U=O.append("g").attr("id","g-ui");D=U;var W=(c-4*t)/3;var V=Q;C(U,t,t,W,V,"2010",true);C(U,t*2+W,t,W,V,"2012",false);C(U,t*3+W*2,t,W,V,"2014",false)};var C=function(X,aa,Y,U,ac,W,V){var Z=X.append("rect").attr("class","ui-button").attr("x",aa).attr("y",Y).attr("width",U).attr("height",ac);Z.on("click",function(){d3.selectAll("rect.ui-button").classed("selected",false);d3.select(this).classed("selected",true);G(W);I(W)});if(V){Z.classed("selected",true)}var ab=X.append("text").attr("class","ui-button").attr("x",aa+U/2).attr("y",Y+ac/2).style("dominant-baseline","central").style("font-size",Q/2).style("font-weight",400).text(W);return Z};var x=function(U){var W=O.append("g").attr("id","g-bars").attr("transform","translate(0, "+(Q+t*2)+")");var V=[];V.push(W.append("text").attr("class","bar-text sin-pobreza").attr("x",t).attr("y",S/2).style("dominant-baseline","middle").style("font-size",M).style("font-weight",400).text("Without poverty "));V.push(W.append("text").attr("class","bar-text pobreza-moderada").attr("x",t).attr("y",S+F+S/2).style("dominant-baseline","middle").style("font-size",M).style("font-weight",400).text("Moderate poverty"));V.push(W.append("text").attr("class","bar-text pobreza-extrema").attr("x",t).attr("y",S*2+F*2+S/2).style("dominant-baseline","middle").style("font-size",M).style("font-weight",400).text("Extreme poverty "));j=137;d=d3.scale.linear().domain([0,65000000]).range([0,c-(t*2)-j]);var X=R.find(function(Y){return Y.anyo==U});W.append("rect").attr("class","bar-rect fondo").attr("x",j+t).attr("y",0).attr("width",0).attr("height",S).attr("width",d(65000000)).style("fill",m.url());W.append("rect").attr("class","bar-rect sin-pobreza").attr("x",j+t).attr("y",0).attr("width",0).attr("height",S).transition().duration(y).attr("width",d(X.sin_pobreza));W.append("text").attr("class","bar-rect-text sin-pobreza").attr("x",j+t*2).attr("y",S/2).style("dominant-baseline","central").style("font-size",S/3).style("font-weight",400).text(J(X.sin_pobreza));W.append("rect").attr("class","bar-rect fondo").attr("x",j+t).attr("y",S+F).attr("width",0).attr("height",S).attr("width",d(65000000)).style("fill",m.url());W.append("rect").attr("class","bar-rect pobreza-moderada").attr("x",j+t).attr("y",S+F).attr("width",0).attr("height",S).transition().duration(y).attr("width",d(X.pobreza_moderada));W.append("text").attr("class","bar-rect-text pobreza-moderada").attr("x",j+t*2).attr("y",S+F+S/2).style("dominant-baseline","central").style("font-size",S/3).style("font-weight",400).text(J(X.pobreza_moderada));W.append("rect").attr("class","bar-rect fondo").attr("x",j+t).attr("y",S*2+F*2).attr("width",0).attr("height",S).attr("width",d(65000000)).style("fill",m.url());W.append("rect").attr("class","bar-rect pobreza-extrema").attr("x",j+t).attr("y",S*2+F*2).attr("width",0).attr("height",S).transition().duration(y).attr("width",d(X.pobreza_extrema));W.append("text").attr("class","bar-rect-text pobreza-extrema").attr("x",j+t*2).attr("y",S*2+F*2+S/2).style("dominant-baseline","central").style("font-size",S/3).style("font-weight",400).text(J(X.pobreza_extrema));T=W};var G=function(U){var V=R.find(function(W){return W.anyo==U});d3.select(".bar-rect.pobreza-extrema").transition().duration(y).attr("width",d(V.pobreza_extrema));d3.select(".bar-rect-text.pobreza-extrema").text(J(V.pobreza_extrema));d3.select(".bar-rect.pobreza-moderada").transition().duration(y).attr("width",d(V.pobreza_moderada));d3.select(".bar-rect-text.pobreza-moderada").transition().duration(y).text(J(V.pobreza_moderada));d3.select(".bar-rect.sin-pobreza").transition().duration(y).attr("width",d(V.sin_pobreza));d3.select(".bar-rect-text.sin-pobreza").text(J(V.sin_pobreza))};var A=function(X){var ad=o.find(function(an){return an.anyo==X});var af=D.node().getBBox().height+T.node().getBBox().height+t*6;w=d3.scale.linear().domain([0,30000000]).range([0,N]);var V=O.append("g").attr("id","g-squares").attr("transform","translate(0, "+af+")");V.append("line").attr("stroke-dasharray","5, 5").attr("x1",0).attr("y1",250/2).attr("x2",c).attr("y2",250/2).style("stroke","#ddd").style("stroke-width",1);V.append("line").attr("stroke-dasharray","5, 5").attr("x1",c/2).attr("y1",0).attr("x2",c/2).attr("y2",250).style("stroke","#ddd").style("stroke-width",1);var ak=w(ad.pobreza_extrema_ca);var ab=Math.sqrt(ak);var ae=ab/Math.sqrt(2);var ag=w(ad.pobreza_extrema);var ai=Math.sqrt(ag);var am=ai/Math.sqrt(2);var W=c/2+am-ae;var U=250/2-am;H=V.append("rect").attr("class","pobreza-extrema").attr("x",W).attr("y",U).attr("width",ai).attr("height",ai).attr("transform","rotate(45, "+W+", "+U+")");a=V.append("text").attr("class","pobreza-extrema").attr("x",c/2+am-ae-5).attr("y",250/2+15+am).style("dominant-baseline","central").style("font-size",M).style("font-weight",400).text("Extreme poverty: "+J(ad.pobreza_extrema));var ac=w(ad.carencia_alimentacion);var al=Math.sqrt(ac);var Y=al/Math.sqrt(2);var aa=c/2-Y+ae;var Z=250/2-Y;b=V.append("rect").attr("class","carencia-alimentaria").attr("x",aa).attr("y",Z).attr("width",al).attr("height",al).attr("transform","rotate(45, "+aa+", "+Z+")");s=V.append("text").attr("class","carencia-alimentaria").attr("x",aa-5).attr("y",Z-15).style("dominant-baseline","central").style("font-size",M).style("font-weight",400).text("Malnourishment: "+J(ad.carencia_alimentacion));var aj=c/2;var ah=250/2-ae;q=V.append("rect").attr("class","pobreza-extrema-ca").attr("x",aj).attr("y",ah).attr("width",ab).attr("height",ab).attr("transform","rotate(45, "+aj+", "+ah+")");k=V.append("text").attr("class","pobreza-extrema-ca").attr("x",c/2).attr("y",0).style("dominant-baseline","central").style("font-size",M*1.2).style("text-anchor","middle").style("font-variant","small-caps").style("font-weight",400).text("Extreme poverty + Malnourishment: "+J(ad.pobreza_extrema_ca));s.on("mouseover",function(){s.classed("transparent",false);a.classed("transparent",true);k.classed("transparent",true);b.classed("transparent",false);H.classed("transparent",true);q.classed("transparent",true)}).on("mouseout",function(){s.classed("transparent",false);a.classed("transparent",false);k.classed("transparent",false);b.classed("transparent",false);H.classed("transparent",false);q.classed("transparent",false)});b.on("mouseover",function(){s.classed("transparent",false);a.classed("transparent",true);k.classed("transparent",true);b.classed("transparent",false);H.classed("transparent",true);q.classed("transparent",true)}).on("mouseout",function(){s.classed("transparent",false);a.classed("transparent",false);k.classed("transparent",false);b.classed("transparent",false);H.classed("transparent",false);q.classed("transparent",false)});a.on("mouseover",function(){s.classed("transparent",true);a.classed("transparent",false);k.classed("transparent",true);b.classed("transparent",true);H.classed("transparent",false);q.classed("transparent",true)}).on("mouseout",function(){s.classed("transparent",false);a.classed("transparent",false);k.classed("transparent",false);b.classed("transparent",false);H.classed("transparent",false);q.classed("transparent",false)});H.on("mouseover",function(){s.classed("transparent",true);a.classed("transparent",false);k.classed("transparent",true);b.classed("transparent",true);H.classed("transparent",false);q.classed("transparent",true)}).on("mouseout",function(){s.classed("transparent",false);a.classed("transparent",false);k.classed("transparent",false);b.classed("transparent",false);H.classed("transparent",false);q.classed("transparent",false)});k.on("mouseover",function(){s.classed("transparent",true);a.classed("transparent",true);k.classed("transparent",false);b.classed("transparent",true);H.classed("transparent",true);q.classed("transparent",false)}).on("mouseout",function(){s.classed("transparent",false);a.classed("transparent",false);k.classed("transparent",false);b.classed("transparent",false);H.classed("transparent",false);q.classed("transparent",false)});q.on("mouseover",function(){s.classed("transparent",true);a.classed("transparent",true);k.classed("transparent",false);b.classed("transparent",true);H.classed("transparent",true);q.classed("transparent",false)}).on("mouseout",function(){s.classed("transparent",false);a.classed("transparent",false);k.classed("transparent",false);b.classed("transparent",false);H.classed("transparent",false);q.classed("transparent",false)})};var I=function(ad){var V=o.find(function(al){return al.anyo==ad});var Y=w(V.pobreza_extrema_ca);var ag=Math.sqrt(Y);var ah=ag/Math.sqrt(2);var Z=w(V.pobreza_extrema);var ai=Math.sqrt(Z);var X=ai/Math.sqrt(2);var af=c/2+X-ah;var ac=250/2-X;H.transition().duration(y).attr("x",af).attr("y",ac).attr("width",ai).attr("height",ai).attr("transform","rotate(45, "+af+", "+ac+")");a.transition().duration(y).attr("x",c/2+X-ah-5).attr("y",250/2+15+X).text("Extreme poverty: "+J(V.pobreza_extrema));var W=w(V.carencia_alimentacion);var U=Math.sqrt(W);var aa=U/Math.sqrt(2);var ak=c/2-aa+ah;var aj=250/2-aa;b.transition().duration(y).attr("x",ak).attr("y",aj).attr("width",U).attr("height",U).attr("transform","rotate(45, "+ak+", "+aj+")");s.transition().duration(y).attr("x",ak-5).attr("y",aj-15).text("Malnourishment: "+J(V.carencia_alimentacion));var ae=c/2;var ab=250/2-ah;q.transition().duration(y).attr("x",ae).attr("y",ab).attr("width",ag).attr("height",ag).attr("transform","rotate(45, "+ae+", "+ab+")");k.transition().duration(y).attr("x",c/2).text("Extreme poverty + Malnourishment: "+J(V.pobreza_extrema_ca))};var P=function(){L();var U="2010";z();x(U);A(U);K()};var n=function(U){queue().defer(d3.csv,"data/contexto_pobreza.csv").defer(d3.csv,"data/pobreza_extrema_ca.csv").await(function(W,X,V){R=X;o=V;U()})};B.prototype={render:function(){f();n(P)}};return B})();new Vis("vis-distribucion-pobreza");